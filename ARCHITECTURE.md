# Reverse Challenge System - Technical Architecture

## ğŸ¯ System Overview

The Reverse Challenge System inverts the traditional challenge-solving paradigm. Instead of solvers submitting code to a central platform, **Challengers proactively push problems to Solvers**, who process them using their own computational resources and return results via authenticated callbacks.

## ğŸ—ï¸ High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    CHALLENGER       â”‚                    â”‚       SOLVER        â”‚
â”‚                     â”‚                    â”‚                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â‘   Push Challenge â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Challenge Store â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ Receive Handler â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   (HMAC Signed)    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                    â”‚          â”‚          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                    â”‚          â–¼          â”‚
â”‚ â”‚ Callback Handlerâ”‚ â”‚   â‘¡  Async Callback â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Worker Pool     â”‚ â”‚
â”‚          â”‚          â”‚   (HMAC Signed)    â”‚ â”‚â€¢ Process Tasks  â”‚ â”‚
â”‚          â–¼          â”‚                    â”‚ â”‚â€¢ Retry Logic    â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                    â”‚ â”‚â€¢ Backoff/Jitter â”‚ â”‚
â”‚ â”‚ Answer Validatorâ”‚ â”‚                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚â€¢ Exact Match    â”‚ â”‚                    â”‚                     â”‚
â”‚ â”‚â€¢ Numeric Range  â”‚ â”‚                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚â€¢ Regex Pattern  â”‚ â”‚                    â”‚ â”‚    Mock Solver  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                    â”‚ â”‚â€¢ CAPTCHA OCR    â”‚ â”‚
â”‚          â”‚          â”‚                    â”‚ â”‚â€¢ Math Compute   â”‚ â”‚
â”‚          â–¼          â”‚                    â”‚ â”‚â€¢ Text Process   â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”‚  Results Store  â”‚ â”‚                    â”‚                     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   SQLite DB     â”‚ â”‚      ğŸ”’ Security Features:
â”‚ â”‚â€¢ challenges     â”‚ â”‚      â€¢ HMAC-SHA256 Authentication  
â”‚ â”‚â€¢ results        â”‚ â”‚      â€¢ Nonce-based Replay Protection
â”‚ â”‚â€¢ webhooks       â”‚ â”‚      â€¢ Time-window Validation
â”‚ â”‚â€¢ seen_nonces    â”‚ â”‚      â€¢ HTTPS-only Callbacks
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â€¢ Request Size Limiting
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Security Architecture

### HMAC Authentication Flow

```
1. Request Preparation:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Original Requestâ”‚
   â”‚ (Method + Path  â”‚
   â”‚  + Headers      â”‚
   â”‚  + Body)        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Canonical Stringâ”‚â”€â”€â”€â”€â”€â”€â”
   â”‚ METHOD\n        â”‚      â”‚
   â”‚ PATH\n          â”‚      â”‚  
   â”‚ TIMESTAMP\n     â”‚      â”‚
   â”‚ NONCE\n         â”‚      â–¼
   â”‚ SHA256(body)    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚HMAC-SHA256â”‚
                         â”‚(secret,   â”‚
                         â”‚canonical) â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚ Authorization:  â”‚        â”‚
   â”‚ RCS-HMAC-SHA256 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚ keyId=xxx,      â”‚
   â”‚ ts=xxx,         â”‚
   â”‚ nonce=xxx,      â”‚
   â”‚ sig=xxx         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Verification Process:
   Requestâ”€â”€â”€â”€â”
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Parse Auth Headerâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     âŒ Reject
   â”‚Check Time Windowâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
   â”‚(Â±300 seconds)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     âŒ Reject
   â”‚Check Nonce Seen â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
   â”‚(Replay Attack)  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     âŒ Reject  
   â”‚Verify Signature â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
   â”‚hmac.Equal()     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â–¼
           âœ… Accept
```

### Nonce Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generate UUID   â”‚    â”‚ Check Database  â”‚    â”‚  Store Nonce    â”‚
â”‚ for Request     â”‚â”€â”€â”€â†’â”‚ for Duplicate   â”‚â”€â”€â”€â†’â”‚  with Timestamp â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚                       â”‚
                                â–¼                       â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ Reject if Found â”‚    â”‚ Periodic Cleanupâ”‚
                       â”‚ (Replay Attack) â”‚    â”‚ (Hourly Process)â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Challenge Processing Flow

### 1. Challenge Creation & Distribution

```
Challenger Process:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Challengeâ”‚
â”‚ â€¢ Problem data  â”‚
â”‚ â€¢ Output spec   â”‚  
â”‚ â€¢ Validation    â”‚
â”‚ â€¢ Answer (local)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Store in DB     â”‚
â”‚ (with answer)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Send to Solver  â”‚
â”‚ â€¢ NO answer     â”‚
â”‚ â€¢ NO validation â”‚
â”‚ â€¢ Only problem  â”‚
â”‚ â€¢ Only output   â”‚
â”‚   specification â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HMAC Sign &     â”‚
â”‚ HTTP POST       â”‚
â”‚ /solve endpoint â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Solver Processing Pipeline

```
Solver Process:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Receive Challengeâ”‚
â”‚ via /solve      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate Requestâ”‚
â”‚ â€¢ HMAC signatureâ”‚
â”‚ â€¢ Content formatâ”‚
â”‚ â€¢ Required fieldsâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Queue in DB     â”‚
â”‚ Status: pending â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Worker Pool     â”‚
â”‚ Picks up task   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Process Problem â”‚
â”‚ â€¢ CAPTCHA â†’ OCR â”‚
â”‚ â€¢ Math â†’ Calc   â”‚
â”‚ â€¢ Text â†’ Transformâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Send Callback   â”‚
â”‚ with Answer     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Worker Pool Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Worker Pool Manager                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Job Queue    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Dispatcher  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚           â”‚
â”‚  â”‚ (DB Poller) â”‚   (Buffered     â”‚             â”‚           â”‚
â”‚  â”‚ Every 5s    â”‚    Channel)     â”‚             â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚             â”‚           â”‚
â”‚                                   â”‚             â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”          â”‚           â”‚
â”‚  â”‚            Job Queue               â”‚          â”‚           â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”   â”‚          â”‚           â”‚
â”‚  â”‚ â”‚ P â”‚â”‚ P â”‚â”‚ P â”‚â”‚ P â”‚â”‚ P â”‚â”‚ P â”‚... â”‚          â”‚           â”‚
â”‚  â”‚ â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜   â”‚          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚           â”‚
â”‚                        â”‚                         â”‚           â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚           â”‚
â”‚         â–¼              â–¼              â–¼          â–¼           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Worker 1  â”‚  â”‚ Worker 2  â”‚  â”‚ Worker 3  â”‚  â”‚ Worker N  â”‚ â”‚
â”‚  â”‚           â”‚  â”‚           â”‚  â”‚           â”‚  â”‚           â”‚ â”‚
â”‚  â”‚ Process   â”‚  â”‚ Process   â”‚  â”‚ Process   â”‚  â”‚ Process   â”‚ â”‚
â”‚  â”‚ Challenge â”‚  â”‚ Challenge â”‚  â”‚ Challenge â”‚  â”‚ Challenge â”‚ â”‚
â”‚  â”‚           â”‚  â”‚           â”‚  â”‚           â”‚  â”‚           â”‚ â”‚
â”‚  â”‚ Send      â”‚  â”‚ Send      â”‚  â”‚ Send      â”‚  â”‚ Send      â”‚ â”‚
â”‚  â”‚ Callback  â”‚  â”‚ Callback  â”‚  â”‚ Callback  â”‚  â”‚ Callback  â”‚ â”‚
â”‚  â”‚ w/ Retry  â”‚  â”‚ w/ Retry  â”‚  â”‚ w/ Retry  â”‚  â”‚ w/ Retry  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Retry Logic with Exponential Backoff

```
Retry Sequence:
Attempt 1: Immediate
     â”‚
     â”œâ”€ Success â”€â”€â”€â–º End
     â”‚
     â”œâ”€ 4xx Error (not 429) â”€â”€â”€â–º Fail (No Retry)
     â”‚
     â””â”€ 429/5xx/Network Error
             â”‚
             â–¼
Attempt 2: Wait 500ms * jitter
     â”‚
     â”œâ”€ Success â”€â”€â”€â–º End  
     â”‚
     â””â”€ Retryable Error
             â”‚
             â–¼
Attempt 3: Wait 1000ms * jitter
     â”‚
     â””â”€ Continue...
             â”‚
             â–¼
Max Attempts: 6
Final Failure: Mark task as failed

Backoff Calculation:
delay = min(30s, 500ms * 2^(attempt-1)) * jitter
where jitter = random(0.85, 1.15)
```

## ğŸ’¾ Data Architecture

### Database Schema Design

```
CHALLENGER DATABASE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ challenges                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (TEXT, PRIMARY KEY)                                   â”‚
â”‚ type (TEXT) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º "captcha", "math", etc  â”‚
â”‚ problem (TEXT) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º JSON blob sent to solverâ”‚
â”‚ output_spec (TEXT) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Expected output format  â”‚
â”‚ validation_rule (TEXT) â”€â”€â”€â”€â”€â”€â”€â”€â–º JSON with answer âš ï¸    â”‚
â”‚ created_at (TIMESTAMP)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ results                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (INTEGER, AUTOINCREMENT)                              â”‚
â”‚ challenge_id (TEXT, FK)                                  â”‚
â”‚ request_id (TEXT) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º X-Request-ID (idempotent)â”‚
â”‚ solver_job_id (TEXT)                                     â”‚
â”‚ status (TEXT) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º "success", "failed"    â”‚
â”‚ received_answer (TEXT)                                   â”‚
â”‚ is_correct (BOOLEAN) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Validation result       â”‚
â”‚ compute_time_ms (INTEGER)                                â”‚
â”‚ solver_metadata (TEXT) â”€â”€â”€â”€â”€â”€â”€â”€â–º JSON from solver        â”‚
â”‚ created_at (TIMESTAMP)                                   â”‚
â”‚ UNIQUE(challenge_id, request_id)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SOLVER DATABASE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ pending_challenges                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (TEXT, PRIMARY KEY)                                   â”‚
â”‚ problem (TEXT) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º JSON problem data       â”‚
â”‚ output_spec (TEXT) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Expected format         â”‚
â”‚ callback_url (TEXT) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Where to send result    â”‚
â”‚ received_at (TIMESTAMP)                                  â”‚
â”‚ status (TEXT) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º "pending", "processing", â”‚
â”‚                                  "completed", "failed"   â”‚
â”‚ attempt_count (INTEGER)                                  â”‚
â”‚ next_retry_time (TIMESTAMP)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Answer Security Model

```
CRITICAL SECURITY PRINCIPLE:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CHALLENGER    â”‚              â”‚     SOLVER      â”‚
â”‚                 â”‚              â”‚                 â”‚
â”‚ âœ… Has Answer   â”‚              â”‚ âŒ No Answer    â”‚
â”‚ âœ… Has Validationâ”‚              â”‚ âŒ No Validation â”‚
â”‚ âœ… Verifies     â”‚              â”‚ âŒ Cannot Verify â”‚
â”‚ âœ… Stores Resultâ”‚              â”‚ âŒ No Results   â”‚
â”‚                 â”‚              â”‚                 â”‚
â”‚ NEVER SENDS:    â”‚   Network    â”‚ ONLY RECEIVES:  â”‚
â”‚ â€¢ Answer        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â€¢ Problem Data  â”‚
â”‚ â€¢ Validation    â”‚   Traffic    â”‚ â€¢ Output Spec   â”‚
â”‚ â€¢ Success/Fail  â”‚              â”‚ â€¢ Constraints   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Data Flow Validation:
1. Challenger creates problem + answer
2. Challenger stores answer locally only
3. Challenger sends problem (NO ANSWER) to solver
4. Solver processes and returns candidate answer
5. Challenger validates answer against local truth
6. Challenger stores validation result locally
```

## ğŸš€ Performance Characteristics

### Throughput & Latency

```
Expected Performance (Single Instance):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component        â”‚ Metric              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Challenger       â”‚ 100 challenges/sec  â”‚
â”‚ Callback Handler â”‚ 200 callbacks/sec   â”‚
â”‚ Solver Workers   â”‚ 50 tasks/sec        â”‚
â”‚ HMAC Verificationâ”‚ 1000 requests/sec   â”‚
â”‚ SQLite (WAL)     â”‚ 2000 writes/sec     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Latency Distribution:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Operation        â”‚ p50    â”‚ p95   â”‚p99  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Challenge Send   â”‚ 50ms   â”‚ 200ms â”‚400msâ”‚
â”‚ Callback Receive â”‚ 10ms   â”‚ 50ms  â”‚100msâ”‚
â”‚ Answer Validationâ”‚ 1ms    â”‚ 5ms   â”‚10ms â”‚
â”‚ Database Write   â”‚ 5ms    â”‚ 20ms  â”‚50ms â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scaling Limits

```
Single Instance Limits:
â€¢ Challenger: ~10,000 active challenges
â€¢ Solver: ~1,000 pending tasks  
â€¢ Database: ~100MB (1M challenges)
â€¢ Memory: ~50MB (Go runtime + SQLite cache)

Scale-Out Options:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component     â”‚ Scaling Strategy        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Challenger    â”‚ Load balancer + session â”‚
â”‚               â”‚ sticky for callbacks    â”‚
â”‚ Solver        â”‚ Independent instances   â”‚
â”‚ Database      â”‚ PostgreSQL + replicas   â”‚
â”‚ Nonce Store   â”‚ Redis cluster          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ Operational Architecture

### Health Check Strategy

```
Health Check Hierarchy:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   /healthz      â”‚    â”‚    /readyz      â”‚    â”‚     /stats      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ Process alive â”‚    â”‚ â€¢ DB connection â”‚    â”‚ â€¢ Queue depth   â”‚
â”‚ â€¢ Port binding  â”‚    â”‚ â€¢ Disk space    â”‚    â”‚ â€¢ Success rates â”‚
â”‚ â€¢ Basic routing â”‚    â”‚ â€¢ Memory usage  â”‚    â”‚ â€¢ Retry counts  â”‚
â”‚                 â”‚    â”‚ â€¢ Dependency    â”‚    â”‚ â€¢ Latency dist  â”‚
â”‚                 â”‚    â”‚   services      â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      Fast                   Thorough              Diagnostic
    (~1ms)                  (~50ms)               (~100ms)
```

### Observability Stack

```
Logging Pipeline:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Structured JSON â”‚    â”‚ Request Tracing â”‚    â”‚  Aggregation    â”‚
â”‚ (zerolog)       â”‚â”€â”€â”€â†’â”‚ â€¢ request_id    â”‚â”€â”€â”€â†’â”‚ â€¢ ELK Stack     â”‚
â”‚                 â”‚    â”‚ â€¢ challenge_id  â”‚    â”‚ â€¢ Grafana       â”‚
â”‚ â€¢ timestamp     â”‚    â”‚ â€¢ user_agent    â”‚    â”‚ â€¢ Alerts        â”‚
â”‚ â€¢ level         â”‚    â”‚ â€¢ duration      â”‚    â”‚                 â”‚
â”‚ â€¢ message       â”‚    â”‚ â€¢ status_code   â”‚    â”‚ Query Examples: â”‚
â”‚ â€¢ fields        â”‚    â”‚ â€¢ error_code    â”‚    â”‚ â€¢ Error rates   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â€¢ Slow requests â”‚
                                              â”‚ â€¢ Auth failures â”‚
Metrics Collection:                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Application     â”‚
â”‚ â€¢ Request count â”‚
â”‚ â€¢ Response time â”‚
â”‚ â€¢ Error rate    â”‚
â”‚ â€¢ Queue depth   â”‚
â”‚ â€¢ Worker util   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Deployment Patterns

```
Development:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ngrok    â”‚  â”‚ Challenger â”‚  â”‚   Solver   â”‚
â”‚ (public)   â”‚  â”‚ :8080      â”‚  â”‚ :8081      â”‚
â”‚            â”‚  â”‚            â”‚  â”‚            â”‚
â”‚ Internetâ”€â”€â”€â”¼â”€â”€â”¼â”€ localhost â”€â”¼â”€â”€â”¼â”€localhost â”‚
â”‚            â”‚  â”‚            â”‚  â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Production:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load       â”‚  â”‚ Challenger â”‚  â”‚   Solver   â”‚
â”‚ Balancer   â”‚  â”‚ Cluster    â”‚  â”‚ Cluster    â”‚
â”‚ (nginx)    â”‚  â”‚            â”‚  â”‚            â”‚
â”‚            â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ Internetâ”€â”€â”€â”¼â”€â”€â”¼â”€â”‚Instanceâ”‚ â”‚  â”‚ â”‚Instanceâ”‚ â”‚
â”‚            â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚            â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚            â”‚  â”‚ â”‚Instanceâ”‚ â”‚  â”‚ â”‚Instanceâ”‚ â”‚
â”‚            â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Shared Infrastructure     â”‚
              â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
              â”‚ â”‚PostgreSQLâ”‚ â”‚  Redis   â”‚   â”‚  
              â”‚ â”‚(Primary) â”‚ â”‚ (Nonces) â”‚   â”‚
              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

This architecture provides a robust, scalable, and secure foundation for the Reverse Challenge System, with clear separation of concerns and comprehensive security measures.